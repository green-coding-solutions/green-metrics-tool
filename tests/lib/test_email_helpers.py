from lib.email_helpers import chunk_message

def test_chunking_long_lines():

    message_input = """
        <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 0_o >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
        Error: Jobs in queue are waiting for longer than 3 hours
        Errors (list): ['Name Nextcloud af9077b322cb5b9e0b672f58ede6c65287fca455; ID: 58611', 'Name Nextcloud 44955d93ba9f5198a097f68657da1dbfe832ba7f; ID: 58627', 'Name Nextcloud 50331f5e4f67e02abf3c11b7ecc8fbb9766fe2cf; ID: 58633', 'Name Nextcloud 3ae56aa8d21a87e64ab640072dd54b7801d44aec; ID: 58643', 'Name Nextcloud 5ee29decb00508122f008abacea26fb3e122b13c; ID: 58647', 'Name Nextcloud 6a6eeb7469eb49f477e0e0d58432f78796bb5744; ID: 58651', 'Name Nextcloud be238f64d2279b00e97f46259b55642b5be5a034; ID: 58629', 'Name Nextcloud 1cf61a59e075706abc336f6bd3d33a7119837744; ID: 58635', 'Name Nextcloud ed1282c4d39f71dc28c192b391a30bf62bc9523e; ID: 58645', 'Name Nextcloud daf78e8671febec23c334aaed7b8d06521cda119; ID: 58621', 'Name Nextcloud bb94f3bde72737e7950d4a5a072c4d7669cb11be; ID: 58639', 'Name Nextcloud 2c103fe1d189c332e65e44253a670a98d2e08d87; ID: 58665', 'Name Nextcloud a8c06a49cf954f6aa5b23fff1a0bf85813fbcfe1; ID: 58679', 'Name Nextcloud 0ea197ee41dd2311a28aa076c8f2f910e3a40a7b; ID: 58681', 'Name Nextcloud 1cf61a59e075706abc336f6bd3d33a7119837744; ID: 58637', 'Name Nextcloud f4ec0576b4c9fb857fe9f604b0edda8f0c361e3e; ID: 58641', 'Name Nextcloud 26d46ecef91ae3324eac12f6cc3064609985f5f9; ID: 58653', 'Name Nextcloud 23f6f58be97a6bca4b095a09531c28342724f48c; ID: 58655', 'Name Nextcloud 820308b48a8efe0c039ce1d37705ac9527599dd6; ID: 58671', 'Name Nextcloud 84b45058de8ad2cf207221076c40ddd84e0565f9; ID: 58673', 'Name webNRG run - NGO; ID: 59065', 'Name webNRG run - NGO; ID: 59066', 'Name webNRG run - NGO; ID: 59067', 'Name webNRG run - NGO; ID: 59068', 'Name webNRG run - NGO; ID: 59069', 'Name webNRG run - NGO; ID: 59070', 'Name webNRG run - NGO; ID: 59071', 'Name webNRG run - NGO; ID: 59072', 'Name webNRG run - NGO; ID: 59073', 'Name webNRG run - NGO; ID: 59074', 'Name webNRG run - NGO; ID: 59075', 'Name webNRG run - NGO; ID: 59076', 'Name webNRG run - NGO; ID: 59077', 'Name webNRG run - NGO; ID: 59078', 'Name webNRG run - NGO; ID: 59079', 'Name webNRG run - NGO; ID: 59080', 'Name webNRG run - NGO; ID: 59081', 'Name webNRG run - NGO; ID: 59082', 'Name webNRG run - NGO; ID: 59083', 'Name webNRG run - NGO; ID: 59084', 'Name webNRG run - NGO; ID: 59085', 'Name webNRG run - NGO; ID: 59086', 'Name webNRG run - NGO; ID: 59087', 'Name webNRG run - NGO; ID: 59088', 'Name webNRG run - NGO; ID: 59089', 'Name webNRG run - Top 100; ID: 59090', 'Name webNRG run - Top 100; ID: 59092', 'Name webNRG run - Top 100; ID: 59094', 'Name webNRG run - Top 100; ID: 59095', 'Name webNRG run - Top 100; ID: 59096', 'Name webNRG run - Top 100; ID: 59097', 'Name webNRG run - Top 100; ID: 59098', 'Name webNRG run - Top 100; ID: 59099', 'Name webNRG run - Top 100; ID: 59101', 'Name webNRG run - Top 100; ID: 59102', 'Name webNRG run - Top 100; ID: 59103', 'Name webNRG run - Top 100; ID: 59104', 'Name webNRG run - Top 100; ID: 59105', 'Name webNRG run - Top 100; ID: 59106', 'Name webNRG run - Top 100; ID: 59107', 'Name webNRG run - Top 100; ID: 59108', 'Name webNRG run - Top 100; ID: 59109', 'Name webNRG run - Top 100; ID: 59110', 'Name webNRG run - Top 100; ID: 59111', 'Name webNRG run - Top 100; ID: 59112', 'Name webNRG run - Top 100; ID: 59113', 'Name webNRG run - Top 100; ID: 59114', 'Name webNRG run - Top 100; ID: 59115', 'Name webNRG run - Top 100; ID: 59116', 'Name webNRG run - Top 100; ID: 59117', 'Name webNRG run - Top 100; ID: 59118', 'Name webNRG run - Top 100; ID: 59119', 'Name webNRG run - Top 100; ID: 59120', 'Name webNRG run - Top 100; ID: 59121', 'Name webNRG run - Top 100; ID: 59122', 'Name webNRG run - Top 100; ID: 59124', 'Name webNRG run - Top 100; ID: 59125', 'Name webNRG run - Top 100; ID: 59126', 'Name webNRG run - Top 100; ID: 59127', 'Name webNRG run - Top 100; ID: 59128', 'Name webNRG run - Top 100; ID: 59129', 'Name webNRG run - Top 100; ID: 59130', 'Name webNRG run - Top 100; ID: 59131', 'Name webNRG run - Top 100; ID: 59133', 'Name webNRG run - Top 100; ID: 59134', 'Name webNRG run - Top 100; ID: 59135', 'Name webNRG run - Top 100; ID: 59136', 'Name webNRG run - Top 100; ID: 59138', 'Name webNRG run - Top 100; ID: 59139', 'Name webNRG run - Top 100; ID: 59140', 'Name webNRG run - Top 100; ID: 59141', 'Name webNRG run - Top 100; ID: 59142', 'Name webNRG run - Top 100; ID: 59143', 'Name webNRG run - Top 100; ID: 59144', 'Name webNRG run - Top 100; ID: 59145', 'Name webNRG run - Top 100; ID: 59146', 'Name webNRG run - Top 100; ID: 59147', 'Name webNRG run - Top 100; ID: 59148', 'Name webNRG run - Top 100; ID: 59149', 'Name webNRG run - Top 100; ID: 59150', 'Name webNRG run - Top 100; ID: 59152', 'Name webNRG run - Top 100; ID: 59154', 'Name webNRG run - Top 100; ID: 59155', 'Name webNRG run - Top 100; ID: 59156', 'Name webNRG run - Top 100; ID: 59157', 'Name webNRG run - Top 100; ID: 59158', 'Name webNRG run - Top 100; ID: 59159', 'Name webNRG run - Top 100; ID: 59160', 'Name webNRG run - Top 100; ID: 59161', 'Name webNRG run - Top 100; ID: 59162', 'Name webNRG run - Top 100; ID: 59163', 'Name webNRG run - Top 100; ID: 59164', 'Name webNRG run - Top 100; ID: 59165', 'Name webNRG run - Top 100; ID: 59166', 'Name webNRG run - Top 100; ID: 59167', 'Name webNRG run - Top 100; ID: 59169', 'Name webNRG run - Top 100; ID: 59170', 'Name webNRG run - Top 100; ID: 59171', 'Name webNRG run - Top 100; ID: 59172', 'Name webNRG run - Top 100; ID: 59173', 'Name webNRG run - Top 100; ID: 59174', 'Name webNRG run - Top 100; ID: 59175', 'Name webNRG run - Top 100; ID: 59176', 'Name webNRG run - Top 100; ID: 59177', 'Name webNRG run - Top 100; ID: 59178', 'Name webNRG run - Top 100; ID: 59179', 'Name webNRG run - Top 100; ID: 59180', 'Name webNRG run - Top 100; ID: 59181', 'Name webNRG run - Top 100; ID: 59182', 'Name webNRG run - Top 100; ID: 59183', 'Name webNRG run - Top 100; ID: 59185', 'Name webNRG run - Top 100; ID: 59187', 'Name webNRG run - Top 100; ID: 59188', 'Name webNRG run - Top 100; ID: 59189', 'Name webNRG run - NGO; ID: 59217', 'Name webNRG run - NGO; ID: 59218', 'Name webNRG run - NGO; ID: 59219', 'Name webNRG run - NGO; ID: 59220', 'Name webNRG run - NGO; ID: 59221', 'Name webNRG run - NGO; ID: 59222', 'Name webNRG run - NGO; ID: 59224', 'Name webNRG run - NGO; ID: 59225', 'Name webNRG run - NGO; ID: 59226', 'Name webNRG run - NGO; ID: 59228', 'Name webNRG run - NGO; ID: 59229', 'Name webNRG run - NGO; ID: 59231', 'Name webNRG run - NGO; ID: 59232', 'Name webNRG run - NGO; ID: 59233', 'Name webNRG run - NGO; ID: 59234', 'Name webNRG run - NGO; ID: 59235', 'Name webNRG run - NGO; ID: 59236', 'Name webNRG run - NGO; ID: 59237', 'Name webNRG run - NGO; ID: 59238', 'Name webNRG run - NGO; ID: 59239', 'Name webNRG run - NGO; ID: 59241', 'Name webNRG run - Top 100; ID: 59242', 'Name webNRG run - Top 100; ID: 59243', 'Name webNRG run - Top 100; ID: 59244', 'Name webNRG run - Top 100; ID: 59246', 'Name webNRG run - Top 100; ID: 59247', 'Name webNRG run - Top 100; ID: 59248', 'Name webNRG run - Top 100; ID: 59250', 'Name webNRG run - Top 100; ID: 59251', 'Name webNRG run - Top 100; ID: 59252', 'Name webNRG run - Top 100; ID: 59253', 'Name webNRG run - Top 100; ID: 59254', 'Name webNRG run - Top 100; ID: 59255', 'Name webNRG run - Top 100; ID: 59256', 'Name webNRG run - Top 100; ID: 59257', 'Name webNRG run - Top 100; ID: 59260', 'Name webNRG run - Top 100; ID: 59261', 'Name webNRG run - Top 100; ID: 59262', 'Name webNRG run - Top 100; ID: 59263', 'Name webNRG run - Top 100; ID: 59264', 'Name webNRG run - Top 100; ID: 59266', 'Name webNRG run - Top 100; ID: 59268', 'Name webNRG run - Top 100; ID: 59269', 'Name webNRG run - Top 100; ID: 59270', 'Name webNRG run - Top 100; ID: 59271', 'Name webNRG run - Top 100; ID: 59272', 'Name webNRG run - Top 100; ID: 59273', 'Name webNRG run - Top 100; ID: 59274', 'Name webNRG run - Top 100; ID: 59275', 'Name webNRG run - Top 100; ID: 59276', 'Name webNRG run - Top 100; ID: 59277', 'Name webNRG run - Top 100; ID: 59279', 'Name webNRG run - Top 100; ID: 59280', 'Name webNRG run - Top 100; ID: 59281', 'Name webNRG run - Top 100; ID: 59282', 'Name webNRG run - Top 100; ID: 59283', 'Name webNRG run - Top 100; ID: 59284', 'Name webNRG run - Top 100; ID: 59285', 'Name webNRG run - Top 100; ID: 59286', 'Name webNRG run - Top 100; ID: 59287', 'Name webNRG run - Top 100; ID: 59288', 'Name webNRG run - Top 100; ID: 59290', 'Name webNRG run - Top 100; ID: 59291', 'Name webNRG run - Top 100; ID: 59292', 'Name webNRG run - Top 100; ID: 59293', 'Name webNRG run - Top 100; ID: 59294', 'Name webNRG run - Top 100; ID: 59295', 'Name webNRG run - Top 100; ID: 59296', 'Name webNRG run - Top 100; ID: 59297', 'Name webNRG run - Top 100; ID: 59298', 'Name webNRG run - Top 100; ID: 59299', 'Name webNRG run - Top 100; ID: 59300', 'Name webNRG run - Top 100; ID: 59301', 'Name webNRG run - Top 100; ID: 59302', 'Name webNRG run - Top 100; ID: 59303', 'Name webNRG run - Top 100; ID: 59304', 'Name webNRG run - Top 100; ID: 59305', 'Name webNRG run - Top 100; ID: 59306', 'Name webNRG run - Top 100; ID: 59307', 'Name webNRG run - Top 100; ID: 59308', 'Name webNRG run - Top 100; ID: 59309', 'Name webNRG run - Top 100; ID: 59310', 'Name webNRG run - Top 100; ID: 59311', 'Name webNRG run - Top 100; ID: 59312', 'Name webNRG run - Top 100; ID: 59313', 'Name webNRG run - Top 100; ID: 59315', 'Name webNRG run - Top 100; ID: 59317', 'Name webNRG run - Top 100; ID: 59318', 'Name webNRG run - Top 100; ID: 59320', 'Name webNRG run - Top 100; ID: 59321', 'Name webNRG run - Top 100; ID: 59322', 'Name webNRG run - Top 100; ID: 59324', 'Name webNRG run - Top 100; ID: 59325', 'Name webNRG run - Top 100; ID: 59326', 'Name webNRG run - Top 100; ID: 59328', 'Name webNRG run - Top 100; ID: 59329', 'Name webNRG run - Top 100; ID: 59331', 'Name webNRG run - Top 100; ID: 59332', 'Name webNRG run - Top 100; ID: 59333', 'Name webNRG run - Top 100; ID: 59334', 'Name webNRG run - Top 100; ID: 59335', 'Name webNRG run - Top 100; ID: 59336', 'Name webNRG run - Top 100; ID: 59337', 'Name webNRG run - Top 100; ID: 59338', 'Name webNRG run - Top 100; ID: 59339', 'Name webNRG run - Top 100; ID: 59340', 'Name webNRG run - Top 100; ID: 59341', 'Name webNRG run - NGO; ID: 59367', 'Name webNRG run - NGO; ID: 59368', 'Name webNRG run - NGO; ID: 59370', 'Name webNRG run - NGO; ID: 59371', 'Name webNRG run - NGO; ID: 59372', 'Name webNRG run - NGO; ID: 59373', 'Name webNRG run - NGO; ID: 59374', 'Name webNRG run - NGO; ID: 59375', 'Name webNRG run - NGO; ID: 59376', 'Name webNRG run - NGO; ID: 59377', 'Name webNRG run - NGO; ID: 59378', 'Name webNRG run - NGO; ID: 59379', 'Name webNRG run - NGO; ID: 59381', 'Name webNRG run - NGO; ID: 59382', 'Name webNRG run - NGO; ID: 59383', 'Name webNRG run - NGO; ID: 59384', 'Name webNRG run - NGO; ID: 59385', 'Name webNRG run - NGO; ID: 59386', 'Name webNRG run - NGO; ID: 59387', 'Name webNRG run - NGO; ID: 59388', 'Name webNRG run - NGO; ID: 59389', 'Name webNRG run - NGO; ID: 59390', 'Name webNRG run - NGO; ID: 59391', 'Name webNRG run - Top 100; ID: 59392', 'Name webNRG run - Top 100; ID: 59394', 'Name webNRG run - Top 100; ID: 59397', 'Name webNRG run - Top 100; ID: 59398', 'Name webNRG run - Top 100; ID: 59400', 'Name webNRG run - Top 100; ID: 59402', 'Name webNRG run - Top 100; ID: 59403', 'Name webNRG run - Top 100; ID: 59404', 'Name webNRG run - Top 100; ID: 59407', 'Name webNRG run - Top 100; ID: 59408', 'Name webNRG run - Top 100; ID: 59409', 'Name webNRG run - Top 100; ID: 59410', 'Name webNRG run - Top 100; ID: 59411', 'Name webNRG run - Top 100; ID: 59412', 'Name webNRG run - Top 100; ID: 59413', 'Name webNRG run - Top 100; ID: 59414', 'Name webNRG run - Top 100; ID: 59415', 'Name webNRG run - Top 100; ID: 59416', 'Name webNRG run - Top 100; ID: 59417', 'Name webNRG run - Top 100; ID: 59418', 'Name webNRG run - Top 100; ID: 59419', 'Name webNRG run - Top 100; ID: 59422', 'Name webNRG run - Top 100; ID: 59423', 'Name webNRG run - Top 100; ID: 59424', 'Name webNRG run - Top 100; ID: 59425', 'Name webNRG run - Top 100; ID: 59426', 'Name webNRG run - Top 100; ID: 59427', 'Name webNRG run - Top 100; ID: 59428', 'Name webNRG run - Top 100; ID: 59429', 'Name webNRG run - Top 100; ID: 59430', 'Name webNRG run - Top 100; ID: 59431', 'Name webNRG run - Top 100; ID: 59432', 'Name webNRG run - Top 100; ID: 59433', 'Name webNRG run - Top 100; ID: 59434', 'Name webNRG run - Top 100; ID: 59435', 'Name webNRG run - Top 100; ID: 59436', 'Name Nextcloud 5bfc3e4fb006058f0929ac9b6e35bbad0a46e898; ID: 58609', 'Name webNRG run - Top 100; ID: 59437', 'Name webNRG run - Top 100; ID: 59438', 'Name webNRG run - Top 100; ID: 59439', 'Name Nextcloud f595d32c57819b30c8efa2c8a4c988986eaadbaf; ID: 58603', 'Name webNRG run - Top 100; ID: 59441', 'Name webNRG run - Top 100; ID: 59442', 'Name webNRG run - Top 100; ID: 59443', 'Name Nextcloud 5e674ee1c0c136f66d49eefe53c1d4fc4b478530; ID: 58617', 'Name webNRG run - Top 100; ID: 59444', 'Name webNRG run - Top 100; ID: 59445', 'Name webNRG run - Top 100; ID: 59446', 'Name Nextcloud 51a9df8e836ffb071d53b64fa568c78720dad432; ID: 58659', 'Name webNRG run - Top 100; ID: 59447', 'Name webNRG run - Top 100; ID: 59448', 'Name webNRG run - Top 100; ID: 59449', 'Name webNRG run - Top 100; ID: 59450', 'Name webNRG run - Top 100; ID: 59451', 'Name webNRG run - Top 100; ID: 59452', 'Name webNRG run - Top 100; ID: 59453', 'Name webNRG run - Top 100; ID: 59454', 'Name Nextcloud b16626b6c48063224e4b056c4ff4a1d6b8086eee; ID: 58685', 'Name webNRG run - Top 100; ID: 59455', 'Name webNRG run - Top 100; ID: 59456', 'Name webNRG run - Top 100; ID: 59457', 'Name Nextcloud 1e81f7293ef72a6e6dfeac7f0040c7b1d6362320; ID: 58687', 'Name webNRG run - Top 100; ID: 59458', 'Name webNRG run - Top 100; ID: 59459', 'Name webNRG run - Top 100; ID: 59460', 'Name webNRG run - Top 100; ID: 59461', 'Name webNRG run - Top 100; ID: 59463', 'Name webNRG run - Top 100; ID: 59464', 'Name webNRG run - Top 100; ID: 59465', 'Name webNRG run - Top 100; ID: 59466', 'Name webNRG run - Top 100; ID: 59467', 'Name webNRG run - Top 100; ID: 59468', 'Name webNRG run - Top 100; ID: 59469', 'Name webNRG run - Top 100; ID: 59470', 'Name webNRG run - Top 100; ID: 59471', 'Name Nextcloud 669c84c530f4811e657e318636bd9d0a1ce0d96f; ID: 58661', 'Name Nextcloud 8e8b6ffb8a08024d7130ad2cc90917df935b2936; ID: 58675', 'Name webNRG run - Top 100; ID: 59472', 'Name webNRG run - Top 100; ID: 59473', 'Name webNRG run - Top 100; ID: 59474', 'Name webNRG run - Top 100; ID: 59475', 'Name webNRG run - Top 100; ID: 59476', 'Name webNRG run - Top 100; ID: 59478', 'Name webNRG run - Top 100; ID: 59479', 'Name Nextcloud 990bfafb1a05ae876aefdf2245f526209c020d04; ID: 58691', 'Name webNRG run - Top 100; ID: 59481', 'Name webNRG run - Top 100; ID: 59482', 'Name webNRG run - Top 100; ID: 59483', 'Name webNRG run - Top 100; ID: 59484', 'Name webNRG run - Top 100; ID: 59485', 'Name webNRG run - Top 100; ID: 59486', 'Name webNRG run - Top 100; ID: 59487', 'Name webNRG run - Top 100; ID: 59488', 'Name webNRG run - Top 100; ID: 59490', 'Name webNRG run - Top 100; ID: 59491', 'Name Nextcloud 8e8b6ffb8a08024d7130ad2cc90917df935b2936; ID: 58677', 'Name Nextcloud 14b047b921129a0bb160ca7cc34989c21920c170; ID: 58683', 'Name Nextcloud eba0292af87558433233df6216f736d2d5b2c6f7; ID: 58689', 'Name Nextcloud 5f09b17664eaf81324665e897f9bfd2325a039f3; ID: 58693']
        Traceback_first (bool): False

        <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 0_o >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>

        NoneType: None


        <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<< 0_o >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"""

    message_chunked = chunk_message(message_input)

    assert len(message_input.splitlines()) < len(message_chunked), 'Chunked output did not contain more lines than input. Chunking must have failed'
    assert all(len(el) <= 998 for el in message_chunked), 'Lines in chunked output are longer than 998 chars'
    clean_input = message_input.replace('\n', '')
    clean_output = ''.join(message_chunked).replace('\n', '')
    assert len(clean_input) == len(clean_output), 'Input and output do not have the same length'
    assert clean_input == clean_output, 'Input and Output do not have the same content'

def test_chunking_short_lines():

    message_input = """
        This is an example
        With only short lines
        Nothough should be too long and thus nothing should be chunked
        We hope!"""

    message_chunked = chunk_message(message_input)

    assert len(message_input.splitlines()) == len(message_chunked), 'Chunked output is not identical to input. Chunking must have failed'
    assert all(len(el) <= 998 for el in message_chunked), 'Lines in chunked output are longer than 998 chars'
    clean_input = message_input.replace('\n', '')
    clean_output = ''.join(message_chunked).replace('\n', '')
    assert len(clean_input) == len(clean_output), 'Input and output do not have the same length'
    assert clean_input == clean_output, 'Input and Output do not have the same content'

---
name: Test Stress
author: Dan Mateas
description: test

services:
  test-container-only-cpu:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: "1.2"

  test-container-only-memory:
    image: alpine
    deploy:
      resources:
        limits:
          memory: "100MB"

  test-container-both:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: "1.2"
          memory: "10M"

  test-container-cpu-float:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: 1.2
          memory: "10M"

  test-container-cpu-int:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: 1
          memory: "10M"

  test-container-memory-int:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: 1
          memory: 11000000


  test-container-memory-float:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: 1
          memory: 10000001.23

  test-container-limits-partial:
    image: alpine
    deploy: # allowed to be None

  test-container-limits-none:
    type: container
    image: alpine
    # no deploy key at all

  test-container-cpu-and-memory-in-both:
    image: alpine
    deploy:
      resources:
        limits:
          cpus: 1
          memory: "10M"
    cpus: 1
    mem_limit: "10M"

  test-container-limit-only-service-level:
    image: alpine
    cpus: 1
    mem_limit: "10M"


  test-container-limit-only-service-level-memory-int:
    image: alpine
    cpus: 1
    mem_limit: 11000000

  test-container-limit-only-service-level-memory-float:
    image: alpine
    cpus: 1
    mem_limit: 10000001.23



flow:
  - name: Output Resource Limits
    container: test-container-memory-float
    commands:
      - type: console
        command: echo "Container Memory Limit is $GMT_CONTAINER_MEMORY_LIMIT"
        shell: ash
